<dom-module id="mwc-layout">

    <style>
    :host {
        display: none!important;
    }
    
    :host([active]) {
        display: block!important;
    }
    </style>

    <template>
        <content class="mwc-layout" select="*"></content>
    </template>

    <script>
    HTMLImports.whenReady(function() {
        Polymer({

            activeChange: function(newValue, oldValue) {
                if (newValue === false && oldValue === true) {
                    var region = Object.keys(this.opt);

                    for (var A = 0; A < region.length; A++) {
                        var element = this.querySelectorAll('*[region="' + region[A] + '"]');

                        for (Z = 0; Z < element.length; Z++) {
                            Polymer.dom(element[Z]).childNodes.forEach(function(node) {
                                Polymer.dom(element[Z]).removeChild(node);
                            });
                        }
                    }
                }
            },

            is: "mwc-layout",

            observers: [
                "optChange(opt.*)"
            ],

            optChange: function(change) {
                var region = Object.keys(change.value);

                for (var A = 0; A < region.length; A++) {
                    if (typeof(change.value[region[A]]) === "object") {
                        var element = this.querySelectorAll('*[region="' + region[A] + '"]');

                        for (Z = 0; Z < element.length; Z++) {
                            element[Z].innerHTML = "";

                            Polymer.dom(element[Z]).appendChild(change.value[region[A]]);
                        }
                    } else {
                        if (document.createElement(change.value[region[A]]).constructor !== HTMLElement) {
                            var element = this.querySelectorAll('*[region="' + region[A] + '"]');

                            for (Z = 0; Z < element.length; Z++) {
                                Polymer.dom(element[Z]).appendChild(document.createElement(change.value[region[A]]));
                            }
                        } else {
                            console.log(change.value[region[A]] + " not registered");
                        }
                    }
                }
            },

            properties: {
                active: {
                    notify: true,
                    observer: "activeChange",
                    reflectToAttribute: true,
                    type: Boolean,
                    value: false
                },
                opt: {
                    type: Object
                }
            },

            render: function(opt) {
                this.opt = opt;
            },

            rerender: function(region) {
                for (var A = 0; A < region.length; A++) {
                    var element = this.querySelectorAll('*[region="' + region[A] + '"]');

                    for (Z = 0; Z < element.length; Z++) {
                        Polymer.dom(element[Z]).firstChild.fire("rerender", {
                            region: region[A]
                        });
                    }
                }
            }

        });
    });
    </script>

</dom-module>

<script>
var PolymerLayout = function() {
    this.currentLayout = null;
};

// layout[String]
// opt[Object] one-level deep
// plugIn[Array] placeholder
// rerender[Array]

PolymerLayout.prototype.render = function(layout, opt, plugIn, rerender) {
    if (document.querySelector('mwc-layout[id="' + layout + '"]')) {
        if (opt && Object.prototype.toString.call(opt) == "[object Object]") {
            document.querySelector('mwc-layout[id="' + layout + '"]').render(opt, (Object.prototype.toString.call(plugIn) == "[object Array]" ? plugIn : []));
        } else {
            console.log("opt[object] required");
        }

        if (this.currentLayout != layout) {
            if (this.currentLayout) {
                document.querySelector('mwc-layout[id="' + this.currentLayout + '"]').active = false
            }

            document.querySelector('mwc-layout[id="' + layout + '"]').active = true;

            this.currentLayout = layout;
        } else {
            if (opt && Object.prototype.toString.call(opt) == "[object Object]") {
                if (rerender && Object.prototype.toString.call(rerender) == "[object Array]") {
                    document.querySelector('mwc-layout[id="' + layout + '"]').rerender(rerender);
                } else {
                    document.querySelector('mwc-layout[id="' + layout + '"]').rerender(Object.keys(opt));
                }
            } else {
                console.log("opt[object] required");
            }
        }
    }
};

mwcLayout = new PolymerLayout();
</script>
